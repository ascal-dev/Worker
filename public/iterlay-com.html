<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IteraPlay Ultimate</title>

<style>

/* ================= ROOT ================= */

:root{
--bg:#0f0f0f;
--card:#1b1b1b;
--accent:#00e676;
--blue:#2979ff;
--orange:#ff9100;
--danger:#ff4444;
--text:#ffffff;
--muted:#aaaaaa;
--gold:linear-gradient(45deg,gold,orange);
}

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Arial,Helvetica,sans-serif;
}

body{
background:var(--bg);
color:var(--text);
padding:12px;
}

/* ================= NAV ================= */

.nav{
display:flex;
gap:8px;
flex-wrap:wrap;
justify-content:center;
margin-bottom:14px;
}

.nav button{
padding:6px 14px;
border:0;
border-radius:6px;
background:#2c2c2c;
color:white;
cursor:pointer;
}

.nav button.active{
background:var(--accent);
color:black;
}

/* ================= VIDEO ================= */

video{
width:100%;
max-height:260px;
background:black;
border-radius:8px;
margin-bottom:16px;
}

/* ================= GRID ================= */

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
gap:12px;
}

/* ================= CARD ================= */

.card{
background:var(--card);
border-radius:10px;
overflow:hidden;
display:flex;
flex-direction:column;
transition:0.2s;
}

.card:hover{transform:translateY(-3px);}

.thumb-wrapper{position:relative;background:black;}

.card img{
width:100%;
height:190px;
object-fit:contain;
background:black;
}

.premium-badge{
position:absolute;
top:8px;
left:8px;
background:var(--gold);
color:black;
font-weight:bold;
font-size:11px;
padding:4px 8px;
border-radius:6px;
animation:glow 2s infinite alternate;
}

@keyframes glow{
from{box-shadow:0 0 4px gold;}
to{box-shadow:0 0 14px orange;}
}

.poster-icons{
position:absolute;
top:8px;
right:8px;
display:flex;
gap:6px;
}

.poster-icons button{
background:rgba(0,0,0,0.7);
border:0;
color:white;
padding:4px 6px;
border-radius:5px;
cursor:pointer;
}

/* INFO */

.info{
padding:8px;
display:flex;
flex-direction:column;
flex:1;
}

.info h3{
font-size:13px;
height:32px;
overflow:hidden;
margin-bottom:6px;
}

/* BUTTONS */

.btn{
padding:6px;
border:0;
border-radius:6px;
cursor:pointer;
margin-top:6px;
font-size:12px;
}

.play{background:var(--accent);color:black;}
.openpage{background:var(--blue);color:white;}
.redirect{background:var(--orange);color:black;}
.remove{background:var(--danger);color:white;}

/* ================= PAGINATION ================= */

.pagination{
display:flex;
justify-content:center;
align-items:center;
gap:6px;
margin-top:18px;
flex-wrap:wrap;
}

.pagination button{
padding:6px 10px;
border:0;
border-radius:6px;
background:#2c2c2c;
color:white;
cursor:pointer;
}

.pagination button.active{
background:var(--accent);
color:black;
}

.pagination input{
width:60px;
padding:5px;
border-radius:6px;
border:0;
text-align:center;
}

/* ================= SAVED ================= */

.saved-section{
margin-top:25px;
}

.saved-item{
display:flex;
align-items:center;
gap:8px;
background:#181818;
padding:6px;
border-radius:8px;
margin-bottom:6px;
}

.saved-item img{
width:55px;
height:55px;
object-fit:contain;
background:black;
border-radius:6px;
}

.saved-title{
flex:1;
font-size:12px;
overflow:hidden;
}

/* ================= TOAST ================= */

.toast{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#222;
color:white;
padding:8px 14px;
border-radius:8px;
opacity:0;
transition:0.3s;
z-index:999;
}

.toast.show{opacity:1;}

.loading{text-align:center;padding:30px;color:var(--muted);}

</style>
</head>
<body>

<div class="nav">
<button class="active" onclick="switchTab('trending',this)">Trending</button>
<button onclick="switchTab('all',this)">All</button>
<button onclick="switchTab('viral',this)">Viral</button>
<button onclick="switchTab('recent',this)">Recent</button>
</div>

<video id="player" controls></video>

<div id="grid" class="grid"></div>

<!-- PAGINATION -->
<div class="pagination">
<button onclick="prevPage()">Prev</button>
<span id="pageNumbers"></span>
<button onclick="nextPage()">Next</button>
<input type="number" id="jumpInput" placeholder="Page">
<button onclick="jumpPage()">Go</button>
</div>

<div class="saved-section">
<h2>Saved Links</h2>
<div id="savedContainer"></div>
</div>

<div id="toast" class="toast"></div>

<script>

/* CONFIG */

const PROXY="https://iterplay.httpsfree-tvsdjjnworkersdev.workers.dev/?url=";
const SECRET_KEY="iTeraPl@y_V1d30_S3cur3_K3y_2025_!@#$";
const LIMIT=20;

const API={
all:{url:"https://iteraplay.com/api/get-videos.php",mode:"plain"},
recent:{url:"https://iteraplay.com/api/get-recent-videos.php",mode:"encrypted"},
trending:{url:"https://iteraplay.com/api/get-trending-videos.php",mode:"encrypted"},
viral:{url:"https://iteraplay.com/api/get-viral-videos.php",mode:"auto"}
};

let currentTab="trending";
let currentPage=1;
let videos=[];

/* INIT */

document.addEventListener("DOMContentLoaded",()=>{
loadData();
renderSaved();
});

/* TOAST */

function toast(msg){
const t=document.getElementById("toast");
t.innerText=msg;
t.classList.add("show");
setTimeout(()=>t.classList.remove("show"),2000);
}

/* NAV */

function switchTab(tab,btn){
currentTab=tab;
currentPage=1;
document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
loadData();
}

/* FETCH */

function xorDecrypt(b64,key){
let d=atob(b64),o="";
for(let i=0;i<d.length;i++){
o+=String.fromCharCode(d.charCodeAt(i)^key.charCodeAt(i%key.length));
}
return o;
}

function fetchData(url,mode){
return fetch(PROXY+url)
.then(r=>r.json())
.then(j=>{
if(mode==="plain") return j.videos||[];
if(j.data){
let p=JSON.parse(xorDecrypt(j.data,SECRET_KEY));
return p.videos||p||[];
}
return j.videos||[];
});
}

/* LOAD */

function loadData(){
document.getElementById("grid").innerHTML="<div class='loading'>Loading...</div>";
let api=API[currentTab];
let offset=(currentPage-1)*LIMIT;
let url=api.url+"?offset="+offset+"&limit="+LIMIT+"&reset_seed=true";

fetchData(url,api.mode)
.then(raw=>{
videos=raw.map(v=>({
id:v.id||v.video_id,
title:v.title||v.file_name||"Untitled",
thumbnail:v.thumbnail||"",
is_premium:v.is_premium!==false,
custom_url:v.custom_url||"",
terabox_url:v.terabox_url||v.external_url||""
}));
render();
renderPagination();
});
}

/* RENDER */

function render(){
let g=document.getElementById("grid");
g.innerHTML="";
videos.forEach((v,i)=>{
let card=document.createElement("div");
card.className="card";

let html=`<div class="thumb-wrapper">
<img src="${v.thumbnail}">
${v.is_premium?'<div class="premium-badge">PREMIUM</div>':''}
<div class="poster-icons">
<button onclick="copyLink(${i})">ðŸ“‹</button>
<button onclick="saveLink(${i})">ðŸ’¾</button>
</div>
</div>
<div class="info">
<h3>${v.title}</h3>`;

if(v.is_premium){
html+=`
<button class="btn openpage" onclick="openBypass(${i})">Open Bypass Tera Page</button>
<button class="btn redirect" onclick="redirectBypass(${i})">Redirect For Bypass</button>
`;
}else{
html+=`<button class="btn play" onclick="playFree('${v.custom_url}')">Play</button>`;
}

card.innerHTML=html+"</div>";
g.appendChild(card);
});
}

/* PAGINATION */

function renderPagination(){
let container=document.getElementById("pageNumbers");
container.innerHTML="";

for(let i=Math.max(1,currentPage-2); i<=currentPage+2; i++){
let btn=document.createElement("button");
btn.innerText=i;
if(i===currentPage) btn.classList.add("active");
btn.onclick=()=>{currentPage=i;loadData();}
container.appendChild(btn);
}
}

function nextPage(){
currentPage++;
loadData();
}

function prevPage(){
if(currentPage>1){
currentPage--;
loadData();
}
}

function jumpPage(){
let p=parseInt(document.getElementById("jumpInput").value);
if(p>0){
currentPage=p;
loadData();
}
}

/* SAVED */

function saveLink(i){
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
let v=videos[i];
if(saved.find(s=>s.id===v.id)) return toast("Already Saved");
saved.push(v);
localStorage.setItem("savedLinks",JSON.stringify(saved));
renderSaved();
toast("Saved!");
}

function renderSaved(){
let container=document.getElementById("savedContainer");
container.innerHTML="";
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");

saved.forEach((s,index)=>{
let div=document.createElement("div");
div.className="saved-item";
div.innerHTML=`
<img src="${s.thumbnail}">
<div class="saved-title">${s.title}</div>
<button class="btn redirect" onclick="redirectSaved(${index})">Bypass</button>
<button class="btn remove" onclick="removeSaved(${index})">X</button>
`;
container.appendChild(div);
});
}

function removeSaved(index){
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
saved.splice(index,1);
localStorage.setItem("savedLinks",JSON.stringify(saved));
renderSaved();
toast("Removed");
}

function redirectSaved(index){
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
localStorage.setItem("sharedTeraboxUrl",saved[index].terabox_url);
window.location.href="https://sdjjn.pages.dev/bypasstera.html";
}

/* ACTIONS */

function copyLink(i){
let v=videos[i];
let link=v.terabox_url||v.custom_url;
if(!link)return toast("No link");
navigator.clipboard.writeText(link);
toast("Copied!");
}

function openBypass(){
window.open("https://sdjjn.pages.dev/bypasstera.html","_blank");
}

function redirectBypass(i){
let v=videos[i];
if(!v.terabox_url)return toast("No TeraBox link");
localStorage.setItem("sharedTeraboxUrl",v.terabox_url);
window.location.href="https://sdjjn.pages.dev/bypasstera.html";
}

function playFree(u){
fetch("https://iteraplay.com/s/watch.php?url="+encodeURIComponent(u))
.then(r=>r.text())
.then(h=>{
let m=h.match(/https:\/\/pub-[^'"]+\.mp4/);
if(m){
let p=document.getElementById("player");
p.src=m[0];
p.play();
}
});
}

</script>
</body>
</html>
