<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IteraPlay</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#0f0f0f;color:#fff;padding:10px}

/* NAV */
.nav{display:flex;gap:8px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
.nav button{padding:6px 14px;border:0;border-radius:4px;background:#333;color:#fff;cursor:pointer}
.nav button.active{background:#00c853;color:#000}

/* VIDEO */
video{width:100%;max-height:240px;background:#000;margin-bottom:12px}

/* GRID */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(min-width:768px){.grid{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1024px){.grid{grid-template-columns:repeat(5,1fr)}}

/* CARD */
.card{background:#1c1c1c;border-radius:6px;overflow:hidden;display:flex;flex-direction:column}

/* FULL IMAGE FIX */
.thumb-wrapper{position:relative;background:#000}
.card img{
width:100%;
height:180px;
object-fit:contain;   /* SHOW FULL IMAGE */
background:#000;
}

/* PREMIUM BADGE */
.premium-badge{
position:absolute;
top:8px;left:8px;
background:linear-gradient(45deg,gold,orange);
color:#000;font-size:11px;font-weight:bold;
padding:4px 8px;border-radius:4px;
}

/* ICONS ON POSTER */
.poster-icons{
position:absolute;
top:8px;
right:8px;
display:flex;
gap:6px;
}
.poster-icons button{
background:rgba(0,0,0,0.6);
border:0;
color:#fff;
font-size:14px;
padding:4px 6px;
border-radius:4px;
cursor:pointer;
}

/* INFO */
.info{padding:8px;display:flex;flex-direction:column;flex:1}
.info h3{font-size:13px;height:32px;overflow:hidden;margin-bottom:6px}

/* BUTTONS */
.btn{padding:6px;margin-top:6px;border:0;border-radius:4px;font-size:13px;cursor:pointer}
.play{background:#00c853;color:#000}
.bypass{background:#ff9100;color:#000}
.openpage{background:#2979ff;color:#fff}

/* SAVED SECTION */
.saved-section{margin-top:20px}
.saved-section h2{margin-bottom:8px}
.saved-item{
display:flex;
align-items:center;
gap:8px;
background:#1a1a1a;
padding:6px;
border-radius:6px;
margin-bottom:6px;
}
.saved-item img{
width:50px;
height:50px;
object-fit:contain;
background:#000;
}
.saved-item .title{
flex:1;
font-size:12px;
overflow:hidden;
}
.saved-item button{
padding:4px 6px;
border:0;
border-radius:4px;
cursor:pointer;
font-size:11px;
}
.remove{background:#ff4444;color:#fff}

.loading,.error{text-align:center;padding:20px;color:#aaa}
</style>
</head>
<body>

<div class="nav">
<button class="active" onclick="switchTab('trending',this)">Trending</button>
<button onclick="switchTab('all',this)">All</button>
<button onclick="switchTab('viral',this)">Viral</button>
<button onclick="switchTab('recent',this)">Recent</button>
</div>

<video id="player" controls></video>
<div id="grid" class="grid"></div>

<div class="saved-section">
<h2>Saved Links</h2>
<div id="savedContainer"></div>
</div>

<script>

var PROXY="https://iterplay.httpsfree-tvsdjjnworkersdev.workers.dev/?url=";
var SECRET_KEY="iTeraPl@y_V1d30_S3cur3_K3y_2025_!@#$";
var LIMIT=20;

var API={
all:{url:"https://iteraplay.com/api/get-videos.php",mode:"plain"},
recent:{url:"https://iteraplay.com/api/get-recent-videos.php",mode:"encrypted"},
trending:{url:"https://iteraplay.com/api/get-trending-videos.php",mode:"encrypted"},
viral:{url:"https://iteraplay.com/api/get-viral-videos.php",mode:"auto"}
};

var currentTab="trending";
var offset=0;
var videos=[];

document.addEventListener("DOMContentLoaded",function(){
loadData();
renderSaved();
});

function switchTab(tab,btn){
currentTab=tab;offset=0;
document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
loadData();
}

function xorDecrypt(b64,key){
var d=atob(b64),o="";
for(var i=0;i<d.length;i++){
o+=String.fromCharCode(d.charCodeAt(i)^key.charCodeAt(i%key.length));
}
return o;
}

function fetchPlain(url){
return fetch(PROXY+url).then(r=>r.json()).then(j=>j.videos||[]);
}

function fetchEncrypted(url){
return fetch(PROXY+url).then(r=>r.json()).then(j=>{
var p=JSON.parse(xorDecrypt(j.data,SECRET_KEY));
return p.videos||p||[];
});
}

function fetchAuto(url){
return fetch(PROXY+url).then(r=>r.json()).then(j=>{
if(j.videos)return j.videos;
if(j.data){
var p=JSON.parse(xorDecrypt(j.data,SECRET_KEY));
return p.videos||p||[];
}
return[];
});
}

function normalize(v){
return{
id:v.id||v.video_id||null,
title:v.title||v.display_name||v.file_name||"Untitled",
thumbnail:v.thumbnail||"",
is_premium:v.is_premium===false?false:true,
video_url:v.video_url||"",
custom_url:v.custom_url||"",
terabox_url:v.terabox_url||v.external_url||"",
date:v.upload_date||v.created_at||""
};
}

function loadData(){
showLoading();
var api=API[currentTab];
var url=api.url+"?offset="+offset+"&limit="+LIMIT+"&reset_seed=true";
var f=api.mode==="plain"?fetchPlain:api.mode==="encrypted"?fetchEncrypted:fetchAuto;

f(url).then(raw=>{
videos=[];
raw.forEach(r=>videos.push(normalize(r)));
render();
}).catch(()=>showError("Failed to load"));
}

function render(){
var g=document.getElementById("grid");
g.innerHTML="";
if(!videos.length){showError("No videos found");return;}

videos.forEach((v,i)=>{
var c=document.createElement("div");
c.className="card";

var h='<div class="thumb-wrapper">';
h+='<img src="'+v.thumbnail+'">';

if(v.is_premium){
h+='<div class="premium-badge">PREMIUM</div>';
}

h+='<div class="poster-icons">';
h+='<button onclick="copyLink('+i+')">ðŸ“‹</button>';
h+='<button onclick="saveLink('+i+')">ðŸ’¾</button>';
h+='</div></div>';

h+='<div class="info"><h3>'+v.title+'</h3>';

if(v.is_premium){
h+='<button class="btn openpage" onclick="openBypass('+i+')">Open Bypass Tera Page</button>';
h+='<button class="btn bypass" onclick="redirectBypass('+i+')">Redirect For Bypass</button>';
}else{
h+='<button class="btn play" onclick="playFree(\''+v.custom_url+'\')">Play</button>';
}

c.innerHTML=h+"</div>";
g.appendChild(c);
});
}

function playFree(u){
fetch("https://iteraplay.com/s/watch.php?url="+encodeURIComponent(u))
.then(r=>r.text())
.then(h=>{
var m=h.match(/https:\/\/pub-[^'"]+\.mp4/);
if(m){
var p=document.getElementById("player");
p.src=m[0];p.play();
}
});
}

function copyLink(i){
var v=videos[i];
var link=v.terabox_url||v.video_url||v.custom_url;
if(!link)return alert("No link");
navigator.clipboard.writeText(link);
alert("Copied!");
}

function openBypass(i){
var v=videos[i];
if(!v.terabox_url)return alert("No TeraBox link");
window.open("https://sdjjn.pages.dev/bypasstera.html","_blank");
}

function redirectBypass(i){
var v=videos[i];
if(!v.terabox_url)return alert("No TeraBox link");
localStorage.setItem("sharedTeraboxUrl",v.terabox_url);
window.location.href="https://sdjjn.pages.dev/bypasstera.html";
}

/* SAVE SYSTEM */

function saveLink(i){
var v=videos[i];
var saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");

if(saved.find(s=>s.id===v.id)){
alert("Already saved");return;
}

saved.push({
id:v.id,
title:v.title,
thumbnail:v.thumbnail,
terabox_url:v.terabox_url
});

localStorage.setItem("savedLinks",JSON.stringify(saved));
renderSaved();
alert("Saved!");
}

function renderSaved(){
var container=document.getElementById("savedContainer");
container.innerHTML="";
var saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");

saved.forEach((s,index)=>{
var div=document.createElement("div");
div.className="saved-item";

div.innerHTML=
'<img src="'+s.thumbnail+'">'+
'<div class="title">'+s.title+'</div>'+
'<button class="bypass" onclick="openSavedBypass('+index+')">Bypass</button>'+
'<button class="remove" onclick="removeSaved('+index+')">X</button>';

container.appendChild(div);
});
}

function openSavedBypass(index){
var saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
localStorage.setItem("sharedTeraboxUrl",saved[index].terabox_url);
window.location.href="https://sdjjn.pages.dev/bypasstera.html";
}

function removeSaved(index){
var saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
saved.splice(index,1);
localStorage.setItem("savedLinks",JSON.stringify(saved));
renderSaved();
}

function showLoading(){
document.getElementById("grid").innerHTML="<div class='loading'>Loading...</div>";
}
function showError(m){
document.getElementById("grid").innerHTML="<div class='error'>"+m+"</div>";
}

</script>
</body>
</html>
