<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IteraPlay Ultimate PRO</title>

<style>

/* ================================
   ROOT THEME SYSTEM
================================ */

:root{
--bg:#0f0f0f;
--card:#1b1b1b;
--accent:#00e676;
--blue:#2979ff;
--orange:#ff9100;
--danger:#ff4444;
--text:#ffffff;
--muted:#aaaaaa;
--gold:linear-gradient(45deg,gold,orange);
--shadow:0 10px 25px rgba(0,0,0,0.6);
}

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Arial,Helvetica,sans-serif;
}

body{
background:var(--bg);
color:var(--text);
padding:14px;
min-height:100vh;
}

/* ================= NAVIGATION ================= */

.nav{
display:flex;
gap:8px;
flex-wrap:wrap;
justify-content:center;
margin-bottom:14px;
}

.nav button{
padding:8px 14px;
border:0;
border-radius:6px;
background:#2c2c2c;
color:white;
cursor:pointer;
transition:.2s;
}

.nav button:hover{transform:translateY(-2px);}
.nav button.active{
background:var(--accent);
color:black;
}

/* ================= SEARCH ================= */

.search-bar{
max-width:500px;
margin:0 auto 14px;
display:flex;
gap:8px;
}

.search-bar input{
flex:1;
padding:8px;
border-radius:6px;
border:0;
outline:none;
}

/* ================= VIDEO PLAYER ================= */

video{
width:100%;
max-height:320px;
background:black;
border-radius:10px;
margin-bottom:20px;
box-shadow:var(--shadow);
}

/* ================= GRID ================= */

.grid{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
gap:14px;
}

/* ================= CARD ================= */

.card{
background:var(--card);
border-radius:12px;
overflow:hidden;
display:flex;
flex-direction:column;
box-shadow:var(--shadow);
transition:.25s;
}

.card:hover{transform:translateY(-5px);}

.thumb-wrapper{
position:relative;
background:black;
}

.card img{
width:100%;
height:200px;
object-fit:contain;
background:black;
}

.premium-badge{
position:absolute;
top:8px;
left:8px;
background:var(--gold);
color:black;
font-weight:bold;
font-size:11px;
padding:4px 8px;
border-radius:6px;
animation:glow 2s infinite alternate;
}

@keyframes glow{
from{box-shadow:0 0 5px gold;}
to{box-shadow:0 0 18px orange;}
}

.poster-icons{
position:absolute;
top:8px;
right:8px;
display:flex;
gap:6px;
}

.poster-icons button{
background:rgba(0,0,0,0.7);
border:0;
color:white;
padding:4px 6px;
border-radius:5px;
cursor:pointer;
}

.info{
padding:10px;
display:flex;
flex-direction:column;
flex:1;
}

.info h3{
font-size:13px;
height:34px;
overflow:hidden;
margin-bottom:6px;
}

.btn{
padding:7px;
border:0;
border-radius:6px;
cursor:pointer;
margin-top:6px;
font-size:12px;
transition:.2s;
}

.btn:hover{opacity:.8;}

.play{background:var(--accent);color:black;}
.redirect{background:var(--orange);color:black;}
.openpage{background:var(--blue);color:white;}
.remove{background:var(--danger);color:white;}

/* ================= PAGINATION ================= */

.pagination{
display:flex;
justify-content:center;
gap:6px;
margin-top:18px;
flex-wrap:wrap;
}

.pagination button{
padding:6px 10px;
border:0;
border-radius:6px;
background:#2c2c2c;
color:white;
cursor:pointer;
}

.pagination button.active{
background:var(--accent);
color:black;
}

/* ================= SAVED ================= */

.saved-section{
margin-top:30px;
}

.saved-item{
display:flex;
align-items:center;
gap:8px;
background:#181818;
padding:6px;
border-radius:8px;
margin-bottom:6px;
}

.saved-item img{
width:55px;
height:55px;
object-fit:contain;
background:black;
border-radius:6px;
}

.saved-title{
flex:1;
font-size:12px;
overflow:hidden;
}

/* ================= TOAST ================= */

.toast{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#222;
padding:10px 14px;
border-radius:8px;
opacity:0;
transition:.3s;
z-index:999;
}

.toast.show{opacity:1;}

.loading{
text-align:center;
padding:40px;
color:var(--muted);
}

</style>
</head>
<body>

<div class="nav">
<button class="active" onclick="App.switchTab('trending',this)">Trending</button>
<button onclick="App.switchTab('all',this)">All</button>
<button onclick="App.switchTab('viral',this)">Viral</button>
<button onclick="App.switchTab('recent',this)">Recent</button>
</div>

<div class="search-bar">
<input type="text" id="searchInput" placeholder="Search videos..." oninput="App.search(this.value)">
</div>

<video id="player" controls></video>

<div id="grid" class="grid"></div>

<div class="pagination" id="pagination"></div>

<div class="saved-section">
<h2>Saved Links</h2>
<div id="savedContainer"></div>
</div>

<div id="toast" class="toast"></div>

<script>

/* =========================================
   ITERAPLAY ADVANCED ENGINE
========================================= */

const App = {

CONFIG:{
PROXY:"https://iterplay.httpsfree-tvsdjjnworkersdev.workers.dev/?url=",
SECRET_KEY:"iTeraPl@y_V1d30_S3cur3_K3y_2025_!@#$",
LIMIT:20,
BYPASS_URL:"https://sdjjn.pages.dev/bypasstera.html"
},

STATE:{
tab:"trending",
page:1,
videos:[],
cache:{}
},

API:{
all:{url:"https://iteraplay.com/api/get-videos.php",mode:"plain"},
recent:{url:"https://iteraplay.com/api/get-recent-videos.php",mode:"encrypted"},
trending:{url:"https://iteraplay.com/api/get-trending-videos.php",mode:"encrypted"},
viral:{url:"https://iteraplay.com/api/get-viral-videos.php",mode:"auto"}
},

init(){
this.load();
this.renderSaved();
},

toast(msg){
const t=document.getElementById("toast");
t.innerText=msg;
t.classList.add("show");
setTimeout(()=>t.classList.remove("show"),2000);
},

switchTab(tab,btn){
this.STATE.tab=tab;
this.STATE.page=1;
document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
this.load();
},

search(q){
q=q.toLowerCase();
document.querySelectorAll(".card").forEach(c=>{
c.style.display=c.innerText.toLowerCase().includes(q)?"flex":"none";
});
},

xorDecrypt(b64,key){
let d=atob(b64),o="";
for(let i=0;i<d.length;i++){
o+=String.fromCharCode(d.charCodeAt(i)^key.charCodeAt(i%key.length));
}
return o;
},

async fetchData(url,mode){

if(this.STATE.cache[url]) return this.STATE.cache[url];

let res=await fetch(this.CONFIG.PROXY+url);
let j=await res.json();
let data;

if(mode==="plain") data=j.videos||[];
else if(j.data){
let p=JSON.parse(this.xorDecrypt(j.data,this.CONFIG.SECRET_KEY));
data=p.videos||p||[];
}else data=j.videos||[];

this.STATE.cache[url]=data;
return data;
},

async load(){
document.getElementById("grid").innerHTML="<div class='loading'>Loading...</div>";
let api=this.API[this.STATE.tab];
let offset=(this.STATE.page-1)*this.CONFIG.LIMIT;
let url=api.url+"?offset="+offset+"&limit="+this.CONFIG.LIMIT+"&reset_seed=true";

let raw=await this.fetchData(url,api.mode);

this.STATE.videos=raw.map(v=>({
id:v.id||v.video_id,
title:v.title||v.file_name||"Untitled",
thumbnail:v.thumbnail||"",
terabox_url:v.terabox_url||v.external_url||"",
custom_url:v.custom_url||"",
player_url:""
}));

this.render();
this.renderPagination();
},

bestLink(v){
return v.terabox_url||v.custom_url||v.player_url||"";
},

render(){
let g=document.getElementById("grid");
g.innerHTML="";
this.STATE.videos.forEach((v,i)=>{
let card=document.createElement("div");
card.className="card";
card.innerHTML=`
<div class="thumb-wrapper">
<img loading="lazy" src="${v.thumbnail}">
<div class="poster-icons">
<button onclick="App.copy(${i})">ðŸ“‹</button>
<button onclick="App.save(${i})">ðŸ’¾</button>
</div>
</div>
<div class="info">
<h3>${v.title}</h3>
<button class="btn play" onclick="App.play(${i})">Play</button>
<button class="btn redirect" onclick="App.redirect(${i})">Bypass</button>
</div>
`;
g.appendChild(card);
});
},

renderPagination(){
let p=document.getElementById("pagination");
p.innerHTML="";
for(let i=Math.max(1,this.STATE.page-2);i<=this.STATE.page+2;i++){
let b=document.createElement("button");
b.innerText=i;
if(i===this.STATE.page) b.classList.add("active");
b.onclick=()=>{this.STATE.page=i;this.load();}
p.appendChild(b);
}
},

copy(i){
let link=this.bestLink(this.STATE.videos[i]);
if(!link)return this.toast("No link");
navigator.clipboard.writeText(link);
this.toast("Copied!");
},

save(i){
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
let v=this.STATE.videos[i];
let link=this.bestLink(v);
if(!link)return this.toast("No link");
if(saved.find(s=>s.id===v.id))return this.toast("Already Saved");

saved.push({
id:v.id,
title:v.title,
thumbnail:v.thumbnail,
link:link
});

localStorage.setItem("savedLinks",JSON.stringify(saved));
this.renderSaved();
this.toast("Saved!");
},

renderSaved(){
let container=document.getElementById("savedContainer");
container.innerHTML="";
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");

saved.forEach((s,index)=>{
let div=document.createElement("div");
div.className="saved-item";
div.innerHTML=`
<img src="${s.thumbnail}">
<div class="saved-title">${s.title}</div>
<button class="btn redirect" onclick="App.redirectSaved(${index})">Bypass</button>
<button class="btn remove" onclick="App.removeSaved(${index})">X</button>
`;
container.appendChild(div);
});
},

removeSaved(i){
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
saved.splice(i,1);
localStorage.setItem("savedLinks",JSON.stringify(saved));
this.renderSaved();
this.toast("Removed");
},

redirect(i){
let link=this.bestLink(this.STATE.videos[i]);
if(!link)return this.toast("No link");
localStorage.setItem("sharedTeraboxUrl",link);
window.location.href=this.CONFIG.BYPASS_URL;
},

redirectSaved(i){
let saved=JSON.parse(localStorage.getItem("savedLinks")||"[]");
localStorage.setItem("sharedTeraboxUrl",saved[i].link);
window.location.href=this.CONFIG.BYPASS_URL;
},

async play(i){
let v=this.STATE.videos[i];

if(v.player_url){
document.getElementById("player").src=v.player_url;
return;
}

if(!v.custom_url)return this.toast("No playable link");

let r=await fetch("https://iteraplay.com/s/watch.php?url="+encodeURIComponent(v.custom_url));
let h=await r.text();
let m=h.match(/https:\/\/pub-[^'"]+\.mp4/);

if(m){
v.player_url=m[0];
document.getElementById("player").src=m[0];
}else{
this.toast("Video not found");
}
}

};

document.addEventListener("DOMContentLoaded",()=>App.init());

</script>
</body>
</html>
